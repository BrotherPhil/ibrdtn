From 08e79471b47d644600ef0b32b44c6f8c7e6c7764 Mon Sep 17 00:00:00 2001
From: Thomas Schrader <schrader.thomas@gmail.com>
Date: Fri, 4 Apr 2014 17:04:09 +0200
Subject: [PATCH 2/2] enabled jpake

---
 Crypto.mk                     | 2 ++
 android-config.mk             | 5 ++++-
 include/openssl/opensslconf.h | 6 ++++--
 3 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/Crypto.mk b/Crypto.mk
index 3885e63..4d1523e 100644
--- a/Crypto.mk
+++ b/Crypto.mk
@@ -374,6 +374,8 @@ local_src_files := \
  crypto/hmac/hm_ameth.c \
  crypto/hmac/hm_pmeth.c \
  crypto/hmac/hmac.c \
+ crypto/jpake/jpake.c \
+ crypto/jpake/jpake_err.c \
  crypto/krb5/krb5_asn.c \
  crypto/lhash/lh_stats.c \
  crypto/lhash/lhash.c \
diff --git a/android-config.mk b/android-config.mk
index 323cc39..a822a18 100644
--- a/android-config.mk
+++ b/android-config.mk
@@ -4,6 +4,9 @@
 # They were pruned from the "Makefile" generated by running ./Configure from import_openssl.sh
 #
 
+# JPAKE
+LOCAL_CFLAGS += -DOPENSSL_EXPERIMENTAL_JPAKE
+
 # From CLFAG=	
 LOCAL_CFLAGS += -DOPENSSL_THREADS -D_REENTRANT -DL_ENDIAN #-DTERMIO
 
@@ -12,7 +15,7 @@ LOCAL_CFLAGS += -DDSO_DLFCN -DHAVE_DLFCN_H
 endif
 
 # From DEPFLAG=
-LOCAL_CFLAGS += -DOPENSSL_NO_CAMELLIA -DOPENSSL_NO_CAPIENG -DOPENSSL_NO_CAST -DOPENSSL_NO_CMS -DOPENSSL_NO_GMP -DOPENSSL_NO_IDEA -DOPENSSL_NO_JPAKE -DOPENSSL_NO_MD2 -DOPENSSL_NO_MDC2 -DOPENSSL_NO_RC5 -DOPENSSL_NO_SHA0 -DOPENSSL_NO_RFC3779 -DOPENSSL_NO_SEED -DOPENSSL_NO_STORE -DOPENSSL_NO_WHIRLPOOL
+LOCAL_CFLAGS += -DOPENSSL_NO_CAMELLIA -DOPENSSL_NO_CAPIENG -DOPENSSL_NO_CAST -DOPENSSL_NO_CMS -DOPENSSL_NO_GMP -DOPENSSL_NO_IDEA -DOPENSSL_NO_MD2 -DOPENSSL_NO_MDC2 -DOPENSSL_NO_RC5 -DOPENSSL_NO_SHA0 -DOPENSSL_NO_RFC3779 -DOPENSSL_NO_SEED -DOPENSSL_NO_STORE -DOPENSSL_NO_WHIRLPOOL
 
 # Extra
 LOCAL_CFLAGS += -DOPENSSL_NO_STATIC_ENGINE -DOPENSSL_NO_GOST -DOPENSSL_NO_DTLS1 -DOPENSSL_NO_RSAX -DOPENSSL_NO_RDRAND -DOPENSSL_NO_SCTP -DOPENSSL_NO_HEARTBEATS
diff --git a/include/openssl/opensslconf.h b/include/openssl/opensslconf.h
index f17eaa9..d3bbc1f 100644
--- a/include/openssl/opensslconf.h
+++ b/include/openssl/opensslconf.h
@@ -17,8 +17,10 @@
 #ifndef OPENSSL_NO_IDEA
 # define OPENSSL_NO_IDEA
 #endif
-#ifndef OPENSSL_NO_JPAKE
-# define OPENSSL_NO_JPAKE
+#ifndef OPENSSL_EXPERIMENTAL_JPAKE
+# ifndef OPENSSL_NO_JPAKE
+#  define OPENSSL_NO_JPAKE
+# endif
 #endif
 #ifndef OPENSSL_NO_KRB5
 # define OPENSSL_NO_KRB5
-- 
1.8.3.2

